<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ bot_name }}</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 0; padding: 0; display:flex; height:100vh; flex-direction: column; }
      .container { margin:auto; width:720px; max-width:95%; }
      #chat { border:1px solid #302e41; height:60vh; overflow:auto; padding:10px; background:#fafafa; }
      .msg { margin:6px 0; }
      .you { color:#0b67d0; }
      .bot { color:#2a7f2a; }
      #composer { display:flex; margin-top:8px; }
      #msg { flex:1; padding:8px; font-size:14px; }
            :root{
              --bg-1: #0f172a; /* dark navy */
              --bg-2: #03203c; /* deep blue */
              --accent: #6ee7b7; /* mint */
              --accent-2: #7dd3fc; /* light blue */
              --you-bg: #0b69ff;
              --bot-bg: #e6ffef;
              --muted: #97a0b5;
              --card: rgba(255,255,255,0.04);
            }
            #credit{
              position: fixed;
              bottom: 8px;    
              font-size: 12px;
              color: var(--muted);
            }

            html,body{height:100%;margin:0;font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
            body{background: linear-gradient(135deg,var(--bg-1),var(--bg-2)); color:#e6eef8; display:flex; align-items:center; justify-content:center;padding:24px;}

            .app{ width:900px; max-width:100%; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border-radius:14px; box-shadow:0 8px 30px rgba(2,6,23,0.6); overflow:hidden; }

            header{ padding:20px 24px; display:flex; align-items:center; gap:12px; background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); }
            .logo{ width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:flex;align-items:center;justify-content:center;font-weight:700;color:#022; }
            h1{ font-size:18px;margin:0;color:#fff }
            p.subtitle{ margin:0;color:var(--muted); font-size:13px }

            #chat{ height:62vh; min-height:360px; overflow:auto; padding:20px 24px; display:flex; flex-direction:column; gap:12px; }

            .bubble{ max-width:78%; padding:12px 14px; border-radius:18px; line-height:1.35; box-shadow: 0 2px 8px rgba(2,6,23,0.35); }
            .you{ align-self:flex-end; background:linear-gradient(90deg,var(--you-bg),#0a4ae6); color:white; border-bottom-right-radius:6px; }
            .bot{ align-self:flex-start; background:var(--bot-bg); color:#032a12; border-bottom-left-radius:6px; }

            .meta{ font-size:12px; color:var(--muted); margin-top:6px; }

            .composer{ display:flex; gap:10px; padding:16px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02)); }
            .composer input{ flex:1; padding:12px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#e6eef8; outline:none }
            .composer button{ padding:10px 16px; border-radius:10px; border:0; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#022; font-weight:600; cursor:pointer }

            @media (max-width:640px){ .app{ width:100%; border-radius:10px } header{padding:12px} }
          </style>
        </head>
        <body>  
          <div class="app" role="application">
            <header>
              <div class="logo">H</div>
              <div>
                <h1>{{ bot_name }}</h1>
                <p class="subtitle">Smart Q&A assistant — type below and press Enter</p>
              </div>
            </header>

            <div id="chat" aria-live="polite"></div>

            <div class="composer">
              <input id="msg" placeholder="Ask something..." autocomplete="off" aria-label="Message input" />
              <button id="send" aria-label="Send message">Send</button>
            </div>
          </div>
          <div id="credit">
            © 2025–26 | Dileep Bairwa
          </div>

          <script>
            const chat = document.getElementById('chat');
            const msg = document.getElementById('msg');
            const send = document.getElementById('send');

            function ts(){ const d=new Date(); return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}); }

            function append(who, text){
              const wrap = document.createElement('div');
              const bubble = document.createElement('div');
              bubble.className = 'bubble ' + (who === 'you' ? 'you' : 'bot');
              bubble.textContent = text;
              wrap.appendChild(bubble);
              const meta = document.createElement('div');
              meta.className = 'meta';
              meta.textContent = (who === 'you' ? 'You' : '{{ bot_name }}') + ' • ' + ts();
              wrap.appendChild(meta);
              chat.appendChild(wrap);
              chat.scrollTop = chat.scrollHeight;
            }

            // Append a bot bubble that will be filled with a typing animation
            function appendBotTypingPlaceholder(){
              const wrap = document.createElement('div');
              const bubble = document.createElement('div');
              bubble.className = 'bubble bot';
              bubble.textContent = '...';
              wrap.appendChild(bubble);
              const meta = document.createElement('div');
              meta.className = 'meta';
              meta.textContent = '{{ bot_name }} • ' + ts();
              wrap.appendChild(meta);
              chat.appendChild(wrap);
              chat.scrollTop = chat.scrollHeight;
              return bubble; // return bubble element to update later
            }

            function typeIntoBubble(bubble, text, speed=30){
              bubble.textContent = '';
              let i = 0;
              const iv = setInterval(()=>{
                bubble.textContent += text.charAt(i);
                i += 1;
                chat.scrollTop = chat.scrollHeight;
                if(i >= text.length){
                  clearInterval(iv);
                }
              }, speed);
            }

            async function sendMessage(){
              const text = msg.value.trim();
              if(!text) return;
              append('you', text);
              msg.value = '';
              try{
                  // show typing placeholder while server responds
                  const typingBubble = appendBotTypingPlaceholder();
                  const res = await fetch('/api/message', {
                    method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ message: text })
                  });
                  const data = await res.json();
                  if(data && data.reply){
                    // replace placeholder with animated typing
                    typeIntoBubble(typingBubble, data.reply, 25);
                  }else{
                    // replace placeholder with error
                    typingBubble.textContent = '(no reply)';
                  }
              }catch(e){
                append('bot', '(error contacting server)');
              }
            }

            send.addEventListener('click', sendMessage);
            msg.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') sendMessage(); });

            // welcome
            append('bot', 'Hello! Ask me anything.')
            msg.focus();
          </script>
        </body>
      </html>
